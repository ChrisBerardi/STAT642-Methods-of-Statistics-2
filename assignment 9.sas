* Assignment 9 STAT642 Spring, 2016;

*Problem I;
data NEW;
INPUT F $ NI $ D $ TRT $ Y @@;
CARDS;
1  N E  C  21.4 1  N O C   50.8 1  N L C   53.2
1 .5 E  E  54.8 1 .5 O O   56.9 1 .5 L L  57.7
2  N E  C  11.3 2  N O C   42.7 2  N L C  44.8
2 .5 E  E  47.9 2 .5 O O   46.8 2 .5 L L 54.0
3  N E  C  34.9 3  N O C   61.8 3  N L C 57.8
3 .5 E  E  40.1 3 .5 O O   57.9 3 .5 L L 62.0

RUN;
proc MIXED CL ORDER=DATA;
class NI D F;
model Y = NI D NI*D/residuals;
random F;
LSMEANS NI D NI*D/ADJUST=TUKEY;
run;
proc GLM;
class NI D F;
model Y = F NI D NI*D/SS3;
random F/TEST;
MEANS NI D NI*D;
LSMEANS NI D NI*D/STDERR ADJUST=TUKEY;
run;


proc MIXED CL ORDER=DATA;
class TRT F;
model Y =TRT/residuals;
random F;
LSMEANS TRT/ADJUST=TUKEY;
run;
proc GLM;
class TRT F;
model Y = TRT F/SS3;
random F/TEST;
MEANS  TRT;
LSMEANS TRT/STDERR ADJUST=TUKEY;
run;


*Problem III;
DATA NEW;
INPUT BLOCK $ VOLT  $ Y @@;
X=LOG(Y);
CARDS;

B1 V24 .      B1 V28 .      B1 V32 38.19 B1 V36 .     B1 V40 5.44 B1 V44 1.96 B1 V48  0.55
B2 V24 220.22 B2 V28 .      B2 V32 .     B2 V36 7.66  B2 V40 .    B2 V44 2.54 B2 V48  0.67
B3 V24 270.85 B3 V28 200.67 B3 V32 .     B3 V36 .     B3 V40 6.24 B3 V44 .    B3 V48  0.76
B4 V24 360.14 B4 V28 170.52 B4 V32 45.43 B4 V36 .     B4 V40 .    B4 V44 3.22 B4 V48  .
B5 V24 .      B5 V28 220.12 B5 V32 56.74 B5 V36 9.32  B5 V40 .    B5 V44 .    B5 V48  0.61
B6 V24 300.66 B6 V28 .      B6 V32 55.34 B6 V36 10.41 B6 V40 7.19 B6 V44 .    B6 V48  .
B7 V24 .      B7 V28 190.78 B7 V32 .     B7 V36 8.74  B7 V40 6.92 B7 V44 2.21 B7 V48  .
RUN;
PROC MIXED CL ALPHA=.05;
CLASS BLOCK VOLT;
MODEL X = VOLT /RESIDUALS;
RANDOM BLOCK;
LSMEANS  VOLT/ADJUST=TUKEY;
CONTRAST 'LINEAR' VOLT -3 -2 -1 0 1 2 3;
ESTIMATE 'LINEAR' VOLT -3 -2 -1 0 1 2 3;

PROC GLM;
CLASS BLOCK VOLT;
MODEL X = BLOCK VOLT /SOLUTION;
RANDOM BLOCK/TEST;
MEANS VOLT;
LSMEANS VOLT/STDERR PDIFF ADJUST=TUKEY;
MEANS VOLT/TUKEY;
RUN;

*Problem IV;
data yields; 
INPUT W $ N $ F $ P $ Y @@; 
LABEL W = 'WATER' N = 'NITROGEN' F = 'FIELD' P = 'PHOSPHORUS' Y = 'EFFICIENCY';
cards; 
16  0  F1  P1  8.1    
16  0  F1  P2  9.7
16 130 F1  P1 36.0  
16 130 F1  P2 34.2
16 260 F1  P1 34.6  
16 260 F1  P2 34.0
16  0  F2  P1  8.6   
16  0  F2  P2 15.5
16 130 F2  P1 34.5  
16 130 F2  P2 33.1
16 260 F2  P1 40.7  
16 260 F2  P2 39.3
22  0  F1  P1 10.0  
22  0  F1  P2  6.2
22 130 F1  P1 21.5  
22 130 F1  P2 19.7
22 260 F1  P1 30.7  
22 260 F1  P2 28.9
22  0  F2  P1  5.1   
22  0  F2  P2 10.9
22 130 F2  P1 19.9  
22 130 F2  P2 21.9
22 260 F2  P1 26.4  
22 260 F2  P2 25.7
28  0  F1  P1 10.6  
28  0  F1  P2  6.3
28 130 F1  P1 19.4  
28 130 F1  P2 19.7
28 260 F1  P1 23.2  
28 260 F1  P2 23.0
28  0  F2  P1  4.5   
28  0  F2  P2 10.4
28 130 F2  P1 21.7  
28 130 F2  P2 19.9
28 260 F2  P1 19.4  
28 260 F2  P2 23.2

RUN;
proc GLM; 
class P N W F;
model  Y =  F P F*P W N W*N  W*P N*P W*N*P/ss3;
RANDOM F F*P/test;
LSMEANS P|W|N/stderr diff ADJUST=TUKEY;
run;
proc mixed cl alpha=.05; 
class P N W F;
model  Y =  P W N W*N  W*P N*P  W*N*P/RESIDUALS;
RANDOM F F*P;
LSMEANS P|W|N/ADJUST=TUKEY;
run;

*Problem 5;
data RAW; 
INPUT DEN $ MO $ UNIT $ @;
DO DAY = 1 TO 3;    
INPUT Y @; OUTPUT; END;
LABEL DEN = 'DENSITY' MO = 'MOISTURE'  Y='CO2 EVOLUTION';
cards;                                                             
 1.1 0.10 1  2.70 0.34 0.11
 1.1 0.10 2  2.90 0.34 1.25
 1.1 0.20 3  5.20 5.04 3.70
 1.1 0.20 4  3.60 3.92 2.69
 1.1 0.24 5  4.00 3.47 3.47
 1.1 0.24 6  4.10 3.47 2.46

 1.4 0.10 7  2.60 1.12 0.90
 1.4 0.10 8  2.20 0.78 0.34
 1.4 0.20 9  4.30 3.36 3.02
 1.4 0.20 10 3.90 2.91 2.35
 1.4 0.24 11 1.90 3.02 2.58
 1.4 0.24 12 3.00 3.81 2.69

 1.6 0.10 13 2.00 0.67 0.22
 1.6 0.10 14 3.00 0.78 0.22
 1.6 0.20 15 3.80 2.80 2.02
 1.6 0.20 16 2.60 3.14 2.46
 1.6 0.24 17 1.30 2.69 2.46
 1.6 0.24 18 0.50 0.34 0.00

RUN;
PROC PRINT DATA=RAW;
VAR DEN MO UNIT DAY Y;
RUN;
TITLE2 'ANALYSIS AS A SPLIT PLOT DESIGN-PROC GLM';
PROC GLM DATA=RAW;
 CLASS DEN MO UNIT DAY;
 MODEL Y = DEN MO DEN*MO UNIT(DEN*MO) DAY DEN*DAY MO*DAY DEN*MO*DAY;
 RANDOM UNIT(DEN*MO)/test;
 CONTRAST 'LINEAR MO=.1'  DAY -1 0 1 MO*DAY -1  0 1 0 0 0 0 0 0;
 CONTRAST  'QUAD MO=.1'   DAY 1 -2 1 MO*DAY  1 -2 1 0 0 0 0 0 0;
 CONTRAST 'LINEAR MO=.2'  DAY -1 0 1 MO*DAY  0 0 0 -1  0 1 0 0 0;
 CONTRAST  'QUAD MO=.2'   DAY 1 -2 1 MO*DAY 0 0 0  1 -2 1 0 0 0;
 CONTRAST 'LINEAR MO=.24'  DAY -1 0 1 MO*DAY  0 0 0  0  0 0 -1  0 1;
 CONTRAST  'QUAD MO=.24'   DAY 1 -2 1 MO*DAY 0 0 0  0  0 0 1 -2 1 ;
 LSMEANS  MO*DEN MO*DAY/pdiff stderr ADJUST=TUKEY;
RUN;

TITLE2 'ANALYSIS AS A SPLIT PLOT DESIGN-PROC MIXED TYPE=CS';
PROC MIXED DATA=RAW;
 CLASS DEN MO UNIT DAY;
 MODEL Y = DEN MO DEN*MO DAY DEN*DAY MO*DAY DEN*MO*DAY;
 RANDOM UNIT(DEN*MO);
 REPEATED DAY/SUB=UNIT(DEN*MO) TYPE=CS R RCorr;
 CONTRAST 'LINEAR MO=.1'  DAY -1 0 1 MO*DAY -1  0 1 0 0 0 0 0 0;
 CONTRAST  'QUAD MO=.1'   DAY 1 -2 1 MO*DAY  1 -2 1 0 0 0 0 0 0;
 CONTRAST 'LINEAR MO=.2'  DAY -1 0 1 MO*DAY  0 0 0 -1  0 1 0 0 0;
 CONTRAST  'QUAD MO=.2'   DAY 1 -2 1 MO*DAY 0 0 0  1 -2 1 0 0 0;
 CONTRAST 'LINEAR MO=.24'  DAY -1 0 1 MO*DAY  0 0 0  0  0 0 -1  0 1;
 CONTRAST  'QUAD MO=.24'   DAY 1 -2 1 MO*DAY 0 0 0  0  0 0 1 -2 1 ;
 LSMEANS  MO MO*DAY MO*DEN/ADJUST=TUKEY;
RUN;
TITLE2 'ANALYSIS AS A REPEATED MEASURES DESIGN- WITH AR(1)STRUCTURE ACROSS TIME';
PROC MIXED DATA=RAW;
 CLASS DEN MO UNIT DAY;
 MODEL Y = DEN MO DEN*MO DAY DEN*DAY MO*DAY DEN*MO*DAY;
 RANDOM UNIT(DEN*MO);
 REPEATED DAY/SUB=UNIT(DEN*MO) TYPE=AR(1) R RCorr;
CONTRAST 'LINEAR MO=.1'  DAY -1 0 1 MO*DAY -1  0 1 0 0 0 0 0 0;
 CONTRAST  'QUAD MO=.1'   DAY 1 -2 1 MO*DAY  1 -2 1 0 0 0 0 0 0;
 CONTRAST 'LINEAR MO=.2'  DAY -1 0 1 MO*DAY  0 0 0 -1  0 1 0 0 0;
 CONTRAST  'QUAD MO=.2'   DAY 1 -2 1 MO*DAY 0 0 0  1 -2 1 0 0 0;
 CONTRAST 'LINEAR MO=.24'  DAY -1 0 1 MO*DAY  0 0 0  0  0 0 -1  0 1;
 CONTRAST  'QUAD MO=.24'   DAY 1 -2 1 MO*DAY 0 0 0  0  0 0 1 -2 1 ;
CONTRAST 'LINEAR DEN=1.1'  DAY -1 0 1 DEN*DAY -1  0 1 0 0 0 0 0 0;
 CONTRAST  'QUAD DEN=1.1'   DAY 1 -2 1 DEN*DAY  1 -2 1 0 0 0 0 0 0;
 CONTRAST 'LINEAR DEN=1.4'  DAY -1 0 1 DEN*DAY  0 0 0 -1  0 1 0 0 0;
 CONTRAST  'QUAD DEN=1.4'   DAY 1 -2 1 DEN*DAY 0 0 0  1 -2 1 0 0 0;
 CONTRAST 'LINEAR DEN=1.6'  DAY -1 0 1 DEN*DAY  0 0 0  0  0 0 -1  0 1;
 CONTRAST  'QUAD DEN=1.6'   DAY 1 -2 1 DEN*DAY 0 0 0  0  0 0 1 -2 1 ;
 LSMEANS  MO MO*DAY MO*DEN/ADJUST=TUKEY;
 LSMEANS  DEN*DAY*MO/ADJUST=TUKEY;
RUN;

TITLE2 'ANALYSIS AS A MULTIVARIATE DESIGN-PROC GLM';
*Need to reconfigure data set:;
DATA MULTIVARDATA; SET RAW;
 IF DAY=1 THEN DO; G1=Y;
    RETAIN G1; END;
 IF DAY=2 THEN DO; G2=Y;
    RETAIN G2; END;
 IF DAY=3 THEN DO; G3=Y;
    RETAIN G3; END;
   DROP OBS G;
   IF DAY=3;
 RUN;
PROC PRINT DATA=MULTIVARDATA;
VAR UNIT DEN MO G1-G3;
RUN;
PROC GLM DATA=MULTIVARDATA;
 CLASS DEN MO UNIT;
 MODEL G1-G3 = DEN MO DEN*MO / NOUNI;
 MANOVA H=DEN MO DEN*MO;
 REPEATED DAY 3 (1 2 3) POLYNOMIAL / PRINTE SUMMARY;
 LSMEANS DEN MO DEN*MO/STDERR PDIFF ADJUST=TUKEY;
RUN;

*Problem 7;
DATA;        
INPUT A $ Y D @@;  
LABEL A= ALLOY Y=STRENGTH D=DIAMETER ; 
CARDS;     
 1   37.5  12.5
  1   40.5  14.0
  1   49.0  16.0
  1   51.0  15.0
  1   61.5  18.0
  1   63.0  19.5
  2   57.5  16.5
  2   69.5  17.5
  2   87.0  19.0
  2   92.0  19.5
  2  119.5  22.5
  2  107.0  24.0
  3   38.0  15.5
  3   44.5  16.0
  3   53.0  19.0
  3   55.0  18.0
  3   58.5  19.0
  3   60.0  20.5
RUN;
PROC MEANS;
VAR D;
PROC SORT;BY A;
PROC MEANS; BY A;
VAR Y D;
RUN;
PROC PLOT;  
PLOT Y*D=A; 
TITLE 'MODEL ALLOWING DIFFERENT SLOPES AND INTERCEPTS'; 
PROC GLM;  
CLASS A;
MODEL Y=A D D*A /SOLUTION;  
LSMEANS A/ PDIFF STDERR;
RUN;
TITLE 'MODEL ALLOWING DIFFERENT INTERCEPTS BUT COMMON SLOPES'; 
PROC GLM; 
CLASS A;
MODEL Y=A D /SOLUTION; 
LSMEANS A/ PDIFF STDERR ADJUST=TUKEY;
RUN;
PROC MIXED;  
CLASS A;
MODEL Y=A D  /NOINT SOLUTION;  
LSMEANS A/  ADJUST=TUKEY;
RUN;
TITLE 'MODEL REQUIRING BOTH COMMON SLOPES AND COMMON INTERCEPTS';  
PROC GLM;  
MODEL Y=D /SOLUTION;  
RUN;
TITLE 'MODEL ALLOWING DIFFERENT SLOPES AND INTERCEPTS'; 
PROC GLM;  
CLASS A;
MODEL Y=A D*A /NOINT SOLUTION;  
LSMEANS A/ PDIFF STDERR ADJUST=TUKEY;
RUN;
PROC MIXED;  
CLASS A;
MODEL Y=A D D*A /NOINT SOLUTION;  
LSMEANS A/  ADJUST=TUKEY;
RUN;
